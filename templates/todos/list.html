{% extends 'base.html' %}
{% block title %}TODOs{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h1 class="h3">TODOs</h1>
  <a href="{% url 'todos:create' %}" class="btn btn-primary">+ New TODO</a>
</div>

<form method="get" class="mt-3 mb-3">
  <div class="input-group">
    <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Search...">
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </div>
  {% if query %}
    <div class="form-text">Filtered by: <strong>{{ query }}</strong> â€” <a href="{% url 'todos:index' %}">clear</a></div>
  {% endif %}
  </form>

{% if todos %}
  <ul class="list-group">
    {% for t in todos %}
      <li class="list-group-item d-flex justify-content-between align-items-start">
        <div class="ms-2 me-auto">
          <div class="fw-bold">
            <a href="{% url 'todos:edit' t.id %}">{{ t.title }}</a>
            {% if t.resolved %}<span class="badge bg-success">Resolved</span>{% endif %}
          </div>
          {% if t.description %}<div class="text-muted">{{ t.description|linebreaksbr }}</div>{% endif %}
          <div class="small mt-1">
            {% if t.due_date %}
              Due: {{ t.due_date|date:'Y-m-d H:i' }}
              {% if t.due_date < now and not t.resolved %}
                <span class="badge bg-danger">Overdue</span>
              {% endif %}
            {% else %}
              <span class="text-muted">No due date</span>
            {% endif %}
          </div>
        </div>
        <div class="btn-group">
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'todos:edit' t.id %}">Edit</a>
          <a class="btn btn-sm btn-outline-{{ t.resolved|yesno:'warning,success' }}" href="{% url 'todos:toggle' t.id %}?next={{ request.get_full_path|urlencode }}">{% if t.resolved %}Unresolve{% else %}Resolve{% endif %}</a>
          <a class="btn btn-sm btn-outline-danger" href="{% url 'todos:delete' t.id %}">Delete</a>
        </div>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <div class="alert alert-info">No TODOs yet. Create your first one!</div>
{% endif %}
{% endblock %}
